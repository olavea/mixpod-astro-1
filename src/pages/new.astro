---
import { playlists } from "../models/schema";
import { db } from "../utils/db";
import {
  uniqueNamesGenerator,
  adjectives,
  colors,
  animals,
} from "unique-names-generator";
import type { Config } from "unique-names-generator";

if (Astro.request.method === "POST") {
  const customConfig: Config = {
    dictionaries: [adjectives, colors, animals],
    separator: " ",
    length: 3,
  };
  const randomName: string = uniqueNamesGenerator(customConfig);
  const playlistData = { name: `My new ${randomName} MixPod` };

  const response = await db
    .insert(playlists)
    .values(playlistData)
    .returning({ id: playlists.id, key: playlists.key });

  const playlist = response[0];

  if (playlist.id) {
    return Astro.redirect(`/${playlist.id}/?key=${playlist.key}`);
  }
}

return Astro.redirect(`/`);
---

NOOP
